<!DOCTYPE html>
<html lang="en" data-theme="light">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="theme-color" content="#8c2f39" id="meta-theme-color" />
  <meta name="description" content="OliTopDesign Admin Panel - Manage your traditional Ethiopian clothing collection" />
  <title>OLITOPDESIGN Admin</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
    rel="stylesheet" />
  <link rel="manifest" href="/manifest.json" />
  <style>
    :root {
      --primary: #8c2f39;
      --secondary: #f2c94c;
      --dark: #2d2817;
      --light: #f5f5f5;
      --accent: #33691e;
      --sidebar-width: 250px;
      --header-height: 70px;
      --bg: #f0f2f5;
      --card: #ffffff;
      --text: #2d2817;
      --muted: #6c757d;
      --table-head: #f1f3f5;
      --shadow: 0 4px 10px rgba(0, 0, 0, .08);
    }

    [data-theme="dark"] {
      --bg: #0c0e12;
      --card: #12151b;
      --text: #e6e6e6;
      --muted: #a3a9b3;
      --table-head: #1a2029;
      --shadow: 0 6px 18px rgba(0, 0, 0, .35);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Poppins', sans-serif;
      -webkit-tap-highlight-color: transparent;
    }

    body {
      background: var(--bg);
      color: var(--text);
      line-height: 1.6;
      display: flex;
      min-height: 100vh;
      overflow-x: hidden;
    }

    /* App Shell */
    .app-shell {
      display: flex;
      width: 100%;
      min-height: 100vh;
      background: var(--bg);
    }

    /* Sidebar (MOBILE-ONLY per request) */
    .sidebar {
      width: var(--sidebar-width);
      background: linear-gradient(135deg, var(--primary), #6b1f28);
      color: #fff;
      height: 100vh;
      position: fixed;
      top: 0;
      left: 0;
      overflow-y: auto;
      transition: transform .3s ease-in-out;
      z-index: 1000;
      padding-top: var(--header-height);
      transform: translateX(-100%);
    }

    .sidebar.active {
      transform: translateX(0);
    }

    .sidebar-header {
      padding: 1rem;
      position: fixed;
      top: 0;
      width: var(--sidebar-width);
      background: inherit;
      border-bottom: 1px solid rgba(255, 255, 255, .15);
      z-index: 1001;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: .5rem;
    }

    .sidebar-header img {
      height: 28px;
      width: auto;
    }

    .sidebar-menu {
      padding: 1rem 0;
      margin-top: var(--header-height);
      display: flex;
      flex-direction: column;
      gap: .25rem;
    }

    .menu-item {
      padding: .9rem 1.2rem;
      display: flex;
      align-items: center;
      gap: .75rem;
      border-radius: 10px;
      cursor: pointer;
      transition: background .25s ease;
    }

    .menu-item:hover {
      background: rgba(255, 255, 255, .12);
    }

    .menu-item.active {
      background: rgba(255, 255, 255, .15);
      border-left: 4px solid var(--secondary);
      padding-left: calc(1.2rem - 4px);
    }

    /* Header + Top Nav (DESKTOP primary navigation) */
    .main-content {
      flex: 1;
      margin-left: 0;
      padding: 2rem;
      padding-top: calc(var(--header-height) + 1rem);
      transition: margin-left .3s ease;
      width: 100%;
    }

    .header {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      height: var(--header-height);
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 1rem;
      padding: .75rem 1rem;
      background: var(--bg);
      z-index: 900;
      border-bottom: 1px solid rgba(0, 0, 0, .08);
    }

    .brand {
      display: flex;
      align-items: center;
      gap: .6rem;
      font-weight: 700;
      color: var(--primary);
    }

    .brand img {
      height: 28px;
      width: auto;
    }

    .top-nav {
      display: flex;
      align-items: center;
      gap: .5rem;
    }

    .top-nav .tab {
      padding: .55rem .9rem;
      border-radius: 8px;
      font-size: .95rem;
      cursor: pointer;
      border: 1px solid transparent;
      transition: all .2s;
    }

    .top-nav .tab:hover {
      background: var(--card);
      box-shadow: var(--shadow);
    }

    .top-nav .tab.active {
      background: var(--secondary);
      color: #2b2b2b;
    }

    .header-actions {
      display: flex;
      align-items: center;
      gap: .5rem;
    }

    .btn,
    .chip {
      display: inline-flex;
      align-items: center;
      gap: .5rem;
      padding: .55rem .9rem;
      border-radius: 10px;
      cursor: pointer;
      border: none;
      text-decoration: none;
      font-weight: 500;
    }

    .btn.primary {
      background: var(--primary);
      color: #fff;
    }

    .btn.secondary {
      background: var(--secondary);
      color: #2b2b2b;
    }

    .icon-btn {
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      background: var(--card);
      box-shadow: var(--shadow);
      border: none;
      cursor: pointer;
    }

    .user-info {
      display: flex;
      align-items: center;
      gap: .5rem;
    }

    .user-avatar {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      background: var(--primary);
      display: flex;
      align-items: center;
      justify-content: center;
      color: #fff;
      font-weight: 700;
    }

    /* Mobile hamburger */
    .menu-toggle {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: var(--secondary);
      box-shadow: var(--shadow);
      border: none;
      cursor: pointer;
    }

    /* Cards */
    .dashboard-cards {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
      gap: 1rem;
      margin: 1.2rem 0 2rem;
    }

    .card {
      background: var(--card);
      border-radius: 16px;
      padding: 1.2rem;
      box-shadow: var(--shadow);
      transition: transform .2s ease, box-shadow .2s ease;
      position: relative;
      overflow: hidden;
    }

    .card:hover {
      transform: translateY(-4px);
    }

    .card-icon {
      width: 52px;
      height: 52px;
      border-radius: 12px;
      background: rgba(140, 47, 57, .15);
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: .9rem;
      color: var(--primary);
    }

    .card h3 {
      font-size: 1.4rem;
      margin-bottom: .35rem;
    }

    .card p {
      color: var(--muted);
      font-size: .95rem;
    }

    /* Sections */
    .content-section {
      background: var(--card);
      border-radius: 12px;
      padding: 1.25rem;
      box-shadow: var(--shadow);
      margin-bottom: 1.5rem;
    }

    .section-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: .75rem;
      margin-bottom: .8rem;
      flex-wrap: wrap;
    }

    .section-header h2 {
      color: var(--primary);
      font-size: 1.2rem;
    }

    /* Table */
    .table-container {
      overflow-x: auto;
      margin: .6rem 0;
      border-radius: 10px;
      box-shadow: var(--shadow);
    }

    table {
      width: 100%;
      border-collapse: collapse;
      min-width: 600px;
      background: var(--card);
    }

    th,
    td {
      padding: .8rem 1rem;
      border-bottom: 1px solid rgba(0, 0, 0, .06);
    }

    thead th {
      background: var(--table-head);
      color: var(--text);
      text-transform: uppercase;
      letter-spacing: .4px;
      font-size: .85rem;
    }

    tr:hover {
      background: rgba(0, 0, 0, .03);
    }

    .status {
      padding: .3rem .7rem;
      border-radius: 20px;
      font-size: .8rem;
      font-weight: 600;
    }

    .status-published {
      background: #e6f7ee;
      color: #0c7c59;
    }

    .actions {
      display: flex;
      gap: .4rem;
      flex-wrap: wrap;
    }

    .action-btn {
      padding: .45rem;
      border-radius: 8px;
      border: none;
      cursor: pointer;
    }

    .action-edit {
      background: #e3f2fd;
      color: #1976d2;
    }

    .action-delete {
      background: #ffebee;
      color: #d32f2f;
    }

    /* Forms + Drag & Drop */
    .form-group {
      margin-bottom: 1rem;
    }

    .form-group label {
      display: block;
      margin-bottom: .35rem;
      font-weight: 600;
    }

    .form-control {
      width: 100%;
      padding: .75rem;
      border: 1px solid rgba(0, 0, 0, .12);
      border-radius: 10px;
      background: transparent;
      color: var(--text);
    }

    .form-control:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(140, 47, 57, .15);
    }

    .dropzone {
      border: 2px dashed rgba(0, 0, 0, .2);
      border-radius: 12px;
      padding: 1rem;
      text-align: center;
      transition: background .2s, border-color .2s;
    }

    .dropzone.dragover {
      background: rgba(140, 47, 57, .06);
      border-color: var(--primary);
    }

    .preview-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
      gap: .6rem;
      margin-top: .8rem;
    }

    .preview-item {
      position: relative;
      border-radius: 10px;
      overflow: hidden;
      box-shadow: var(--shadow);
      background: #000;
    }

    .preview-item img {
      width: 100%;
      height: 100px;
      object-fit: cover;
      display: block;
    }

    .preview-item .remove {
      position: absolute;
      top: 6px;
      right: 6px;
      background: rgba(0, 0, 0, .6);
      color: #fff;
      border: none;
      width: 26px;
      height: 26px;
      border-radius: 50%;
      cursor: pointer;
    }

    .progress-bar {
      width: 100%;
      height: 10px;
      background: rgba(0, 0, 0, .08);
      border-radius: 8px;
      overflow: hidden;
      margin-top: .5rem;
    }

    .progress {
      height: 100%;
      width: 0%;
      background: var(--primary);
      transition: width .2s;
    }

    /* Modals */
    .modal-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, .55);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1100;
      padding: 1rem;
    }

    .modal {
      width: min(100%, 950px);
      background: var(--card);
      color: var(--text);
      border-radius: 16px;
      overflow: hidden;
      box-shadow: 0 30px 80px rgba(0, 0, 0, .35);
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1rem 1.2rem;
      border-bottom: 1px solid rgba(0, 0, 0, .08);
    }

    .modal-body {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
      padding: 1rem;
    }

    .modal-body img {
      width: 100%;
      border-radius: 12px;
      height: 360px;
      object-fit: contain;
      background: #000;
    }

    .modal-actions {
      display: flex;
      gap: .5rem;
      flex-wrap: wrap;
      padding: .8rem 1.2rem 1.2rem;
    }

    .close-x {
      background: none;
      border: none;
      font-size: 1.2rem;
      cursor: pointer;
      color: var(--muted);
    }

    /* Notification */
    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 14px 16px;
      border-radius: 10px;
      background: #0c7c59;
      color: #fff;
      box-shadow: var(--shadow);
      transform: translateX(120%);
      transition: transform .3s;
      z-index: 1200;
      max-width: 360px;
    }

    .notification.show {
      transform: translateX(0);
    }

    .notification.error {
      background: #d32f2f;
    }

    /* Offline/Sync */
    .offline-indicator,
    .sync-indicator {
      position: fixed;
      bottom: 20px;
      right: 20px;
      padding: 10px 14px;
      border-radius: 10px;
      color: #fff;
      display: none;
      z-index: 1200;
    }

    .offline-indicator {
      background: #d32f2f;
    }

    .sync-indicator {
      background: #0c7c59;
    }

    /* Login */
    .login-container {
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      background: linear-gradient(135deg, var(--primary), #6b1f28);
      padding: 1rem;
      width: 100%;
    }

    .login-form {
      background: #fff;
      color: #333;
      padding: 2rem;
      border-radius: 12px;
      box-shadow: 0 12px 28px rgba(0, 0, 0, .25);
      width: 100%;
      max-width: 420px;
    }

    .logo-img {
      height: 30px;
      width: auto;
      vertical-align: middle;
    }

    /* Deleted page/section */
    #deletedSection {
      display: none;
    }

    #deletedSection.active {
      display: block;
    }

    /* Responsive rules */
    @media (max-width: 992px) {

      /* Sidebar visible via hamburger */
      .menu-toggle {
        display: flex;
      }

      .sidebar {
        transform: translateX(-100%);
      }

      .sidebar.active {
        transform: translateX(0);
      }

      .top-nav {
        display: none;
      }
    }

    @media (min-width: 993px) {

      /* Sidebar hidden on desktop per request */
      .sidebar {
        display: none;
      }

      .menu-toggle {
        display: none;
      }

      .top-nav {
        display: flex;
      }
    }

    @media (max-width:768px) {
      .modal-body {
        grid-template-columns: 1fr;
      }

      .dashboard-cards {
        grid-template-columns: 1fr;
      }
    }

    @media (max-width:576px) {
      .header {
        padding: .5rem .75rem;
      }

      .user-info span {
        display: none;
      }
    }

    .hidden {
      display: none !important;
    }
  </style>
</head>

<body>
  <div class="app-shell">
    <!-- Offline / Sync -->
    <div class="offline-indicator"><i class="fas fa-wifi"></i> You are offline</div>
    <div class="sync-indicator"><i class="fas fa-sync-alt"></i> Syncing data...</div>

    <!-- Login -->
    <div id="loginPage" style="width:100%">
      <div class="login-container">
        <div class="login-form">
          <h2><img src="https://i.postimg.cc/T3wbf4wJ/photo-2025-03-15-08-51-38-removebg-preview.png"
              alt="OliTopDesign Logo" class="logo-img" /> OliTopDesign Admin</h2>
          <div class="form-group">
            <label for="email">Email</label>
            <input type="email" id="email" class="form-control" placeholder="admin@ethiocloth.com" />
          </div>
          <div class="form-group">
            <label for="password">Password</label>
            <input type="password" id="password" class="form-control" placeholder="Enter your password" />
          </div>
          <button id="loginBtn" class="btn primary" style="width:100%"><span id="loginText">Login</span><span
              id="loginSpinner" class="hidden"></span></button>
          <p id="loginMessage" style="margin-top: .8rem; text-align:center; color:#d32f2f;"></p>
        </div>
      </div>
    </div>

    <!-- Admin Panel -->
    <div id="adminPanel" class="hidden" style="width:100%">
      <!-- Sidebar (mobile only) -->
      <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
          <img src="https://i.postimg.cc/T3wbf4wJ/photo-2025-03-15-08-51-38-removebg-preview.png" alt="logo" />
          <strong>OliTopDesign</strong>
        </div>
        <div class="sidebar-menu">
          <div class="menu-item active" data-section="dashboard"><i class="fas fa-tachometer-alt"></i>
            <span>Dashboard</span>
          </div>
          <div class="menu-item" data-section="gallery"><i class="fas fa-images"></i> <span>Gallery</span></div>
          <div class="menu-item" data-section="addItem"><i class="fas fa-plus-circle"></i> <span>Add Items</span></div>
          <div class="menu-item" data-section="settings"><i class="fas fa-cog"></i> <span>Settings</span></div>
          <div class="menu-item" id="logoutBtn"><i class="fas fa-sign-out-alt"></i> <span>Logout</span></div>
        </div>
      </div>

      <div class="main-content">
        <div class="header">
          <div class="brand">
            <button class="menu-toggle" id="menuToggle"><i class="fas fa-bars"></i></button>
            <img src="https://i.postimg.cc/T3wbf4wJ/photo-2025-03-15-08-51-38-removebg-preview.png" alt="logo" />
            <span>Admin Dashboard</span>
          </div>
          <div class="top-nav" id="topNav">
            <div class="tab active" data-section="dashboard">Dashboard</div>
            <div class="tab" data-section="gallery">Gallery</div>
            <div class="tab" data-section="addItem">Add Items</div>
            <div class="tab" data-section="settings">Settings</div>
          </div>
          <div class="header-actions">
            <button id="themeToggle" class="icon-btn" title="Toggle theme"><i
                class="fas fa-circle-half-stroke"></i></button>
            <div class="user-info">
              <div class="user-avatar" id="userAvatar">A</div>
              <span id="userEmail">Admin User</span>
              <button class="icon-btn" id="logoutBtnHeader" title="Logout"><i
                  class="fas fa-right-from-bracket"></i></button>
            </div>
          </div>
        </div>

        <!-- Dashboard -->
        <div id="dashboardSection" class="content-section">
          <div class="section-header">
            <h2>Dashboard Overview</h2><span id="currentDate"></span>
          </div>
          <div class="dashboard-cards">
            <div class="card">
              <div class="card-icon"><i class="fas fa-images"></i></div>
              <h3 id="totalItems">0</h3>
              <p>Total Gallery Items</p>
            </div>
            <div class="card">
              <div class="card-icon"><i class="fas fa-eye"></i></div>
              <h3>1,254</h3>
              <p>Total Views</p>
            </div>
            <div class="card">
              <div class="card-icon"><i class="fas fa-calendar"></i></div>
              <h3>12</h3>
              <p>Events This Month</p>
            </div>
          </div>
          <div class="section-header">
            <h2>Recent Activity</h2>
          </div>
          <div class="table-container">
            <table>
              <thead>
                <tr>
                  <th>Item</th>
                  <th>Date Added</th>
                  <th>Status</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="recentItems"></tbody>
            </table>
          </div>
        </div>

        <!-- Gallery Management -->
        <div id="gallerySection" class="content-section hidden">
          <div class="section-header">
            <h2>Gallery Management</h2><button class="btn secondary" id="refreshGallery"><i class="fas fa-rotate"></i>
              Refresh</button>
          </div>
          <div class="table-container">
            <table>
              <thead>
                <tr>
                  <th>Image</th>
                  <th>Title</th>
                  <th>Description</th>
                  <th>Date</th>
                  <th>Status</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="galleryItems"></tbody>
            </table>
          </div>
        </div>

        <!-- Add Items -->
        <div id="addItemSection" class="content-section hidden">
          <div class="section-header">
            <h2>Add New Gallery Items</h2>
          </div>
          <form id="addItemForm">
            <div class="form-group"><label for="itemTitle">Title (optional)</label><input type="text" id="itemTitle"
                class="form-control" placeholder="e.g., Habesha Kemis" /></div>
            <div class="form-group"><label for="itemDescription">Description (optional)</label><textarea
                id="itemDescription" class="form-control" placeholder="Short description"></textarea></div>
            <div class="form-group">
              <label>Images</label>
              <div id="dropzone" class="dropzone">
                <p><i class="fas fa-cloud-arrow-up"></i> Drag & drop images here or <strong>click to browse</strong></p>
                <input type="file" id="itemImage" accept="image/*" multiple class="hidden" />
              </div>
              <div id="previewGrid" class="preview-grid"></div>
              <div class="progress-bar" id="progressBarContainer" style="display:none">
                <div class="progress" id="progressBar"></div>
              </div>
            </div>
            <button type="submit" class="btn primary"><i class="fas fa-plus-circle"></i> Upload</button>
            <p id="formMessage" style="margin-top:.6rem"></p>
          </form>
        </div>

        <!-- Settings -->
        <div id="settingsSection" class="content-section hidden">
          <div class="section-header">
            <h2>Settings</h2>
          </div>
          <div class="form-group"><label for="siteTitle">Site Title</label><input type="text" id="siteTitle"
              class="form-control" value="OliTopDesign Showroom" /></div>
          <div class="form-group"><label for="adminEmail">Admin Email</label><input type="email" id="adminEmail"
              class="form-control" value="admin@OliTopDesign.com" /></div>
          <div class="form-group"><label for="maxFileSize">Maximum File Size (MB)</label><input type="number"
              id="maxFileSize" class="form-control" value="10" /></div>
          <button class="btn primary"><i class="fas fa-save"></i> Save Settings</button>
        </div>

        <!-- Deleted confirmation page -->
        <div id="deletedSection" class="content-section">
          <div class="section-header">
            <h2>Item Deleted</h2>
          </div>
          <p>The item was removed successfully from your gallery. You can continue managing your content below.</p>
          <div style="display:flex; gap:.5rem; margin-top:.6rem; flex-wrap:wrap;">
            <button class="btn secondary" data-section="gallery" id="backToGallery"><i class="fas fa-images"></i> Back
              to Gallery</button>
            <button class="btn primary" data-section="addItem" id="addMore"><i class="fas fa-plus"></i> Add
              More</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Gallery Modal (full image + details + actions) -->
    <div id="galleryModal" class="modal-backdrop">
      <div class="modal">
        <div class="modal-header">
          <h3 id="modalTitle">Item</h3>
          <button class="close-x" id="closeModal"><i class="fas fa-xmark"></i></button>
        </div>
        <div class="modal-body">
          <img id="modalImage" alt="Preview" />
          <div>
            <div class="form-group"><label>Description</label>
              <div id="modalDescription" style="white-space:pre-wrap"></div>
            </div>
            <div class="form-group"><label>Date Added</label>
              <div id="modalDate"></div>
            </div>
          </div>
        </div>
        <div class="modal-actions">
          <button class="btn primary" id="modalEdit"><i class="fas fa-pen"></i> Edit</button>
          <button class="btn" id="modalOpen"><i class="fas fa-arrow-up-right-from-square"></i> Open Image</button>
          <button class="btn" id="modalDelete"><i class="fas fa-trash"></i> Delete</button>
          <div style="flex:1"></div>
          <button class="btn" id="modalCloseBottom">Close</button>
        </div>
      </div>
    </div>

    <div id="notification" class="notification"></div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    // ====== Supabase init ======
    const supabaseUrl = 'https://lkvfxpwngckmyfrmygkj.supabase.co';
    const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxrdmZ4cHduZ2NrbXlmcm15Z2tqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTYzMTIzMTYsImV4cCI6MjA3MTg4ODMxNn0.tbqJGNeDgnhv9Bgthzyi5yGhRc2_b_m_ulCDSnxngrU';
    const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

    // ====== Elements ======
    const loginPage = document.getElementById('loginPage');
    const adminPanel = document.getElementById('adminPanel');
    const loginBtn = document.getElementById('loginBtn');
    const logoutBtn = document.getElementById('logoutBtn');
    const logoutBtnHeader = document.getElementById('logoutBtnHeader');
    const loginMessage = document.getElementById('loginMessage');
    const loginText = document.getElementById('loginText');
    const loginSpinner = document.getElementById('loginSpinner');
    const menuItems = document.querySelectorAll('.menu-item');
    const tabs = document.querySelectorAll('.top-nav .tab');
    const contentSections = {
      dashboard: document.getElementById('dashboardSection'),
      gallery: document.getElementById('gallerySection'),
      addItem: document.getElementById('addItemSection'),
      settings: document.getElementById('settingsSection'),
      deleted: document.getElementById('deletedSection'),
    };
    const currentDateEl = document.getElementById('currentDate');
    const totalItemsEl = document.getElementById('totalItems');
    const recentItemsEl = document.getElementById('recentItems');
    const galleryItemsEl = document.getElementById('galleryItems');
    const refreshGalleryBtn = document.getElementById('refreshGallery');

    const addItemForm = document.getElementById('addItemForm');
    const itemTitle = document.getElementById('itemTitle');
    const itemDescription = document.getElementById('itemDescription');
    const itemImage = document.getElementById('itemImage');
    const dropzone = document.getElementById('dropzone');
    const previewGrid = document.getElementById('previewGrid');

    const formMessage = document.getElementById('formMessage');
    const progressBarContainer = document.getElementById('progressBarContainer');
    const progressBar = document.getElementById('progressBar');
    const notification = document.getElementById('notification');
    const userAvatar = document.getElementById('userAvatar');
    const userEmail = document.getElementById('userEmail');
    const menuToggle = document.getElementById('menuToggle');
    const sidebar = document.getElementById('sidebar');
    const backToGallery = document.getElementById('backToGallery');
    const addMore = document.getElementById('addMore');

    // Modal
    const galleryModal = document.getElementById('galleryModal');
    const modalTitle = document.getElementById('modalTitle');
    const modalImage = document.getElementById('modalImage');
    const modalDescription = document.getElementById('modalDescription');
    const modalDate = document.getElementById('modalDate');
    const closeModal = document.getElementById('closeModal');
    const modalCloseBottom = document.getElementById('modalCloseBottom');
    const modalEdit = document.getElementById('modalEdit');
    const modalOpen = document.getElementById('modalOpen');
    const modalDelete = document.getElementById('modalDelete');

    // Theme
    const themeToggle = document.getElementById('themeToggle');
    const metaTheme = document.getElementById('meta-theme-color');

    // State
    let currentEditingId = null;
    let currentImageUrl = null;
    let selectedFiles = [];
    let modalItem = null;

    // ====== Utilities ======
    const show = (el) => el.classList.remove('hidden');
    const hide = (el) => el.classList.add('hidden');
    const notify = (msg, isError = false) => {
      notification.textContent = msg; notification.className = 'notification'; if (isError) notification.classList.add('error');
      notification.classList.add('show'); setTimeout(() => notification.classList.remove('show'), 3000);
    };

    function setTheme(theme) {
      document.documentElement.setAttribute('data-theme', theme);
      localStorage.setItem('theme', theme);
      metaTheme.setAttribute('content', theme === 'dark' ? '#0c0e12' : '#8c2f39');
    }
    setTheme(localStorage.getItem('theme') || 'light');
    themeToggle.addEventListener('click', () => setTheme(document.documentElement.getAttribute('data-theme') === 'dark' ? 'light' : 'dark'));

    // Date
    currentDateEl.textContent = new Date().toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });

    // ====== Auth ======
    async function checkAuth() {
      const { data: { session } } = await supabase.auth.getSession();
      if (session) {
        hide(loginPage); adminPanel.classList.remove('hidden');
        userAvatar.textContent = session.user.email.charAt(0).toUpperCase();
        userEmail.textContent = session.user.email;
        loadDashboardData(); loadGalleryItems();
      } else {
        show(loginPage); adminPanel.classList.add('hidden');
      }
    }

    loginBtn.addEventListener('click', async () => {
      const email = document.getElementById('email').value.trim();
      const password = document.getElementById('password').value;
      if (!email || !password) { loginMessage.textContent = 'Please enter both email and password.'; return; }
      loginText.classList.add('hidden'); loginSpinner.classList.remove('hidden'); loginBtn.disabled = true;
      const { data, error } = await supabase.auth.signInWithPassword({ email, password });
      if (error) { loginMessage.textContent = error.message; notify('Login error: ' + error.message, true); }
      else {
        hide(loginPage); adminPanel.classList.remove('hidden');
        userAvatar.textContent = data.user.email.charAt(0).toUpperCase();
        userEmail.textContent = data.user.email; loadDashboardData(); loadGalleryItems(); notify('Login successful!');
      }
      loginText.classList.remove('hidden'); loginSpinner.classList.add('hidden'); loginBtn.disabled = false;
    });

    async function logout() {
      const { error } = await supabase.auth.signOut();
      if (error) return notify('Logout error: ' + error.message, true);
      show(loginPage); adminPanel.classList.add('hidden');
      document.getElementById('email').value = ''; document.getElementById('password').value = '';
      notify('Logged out successfully');
    }
    logoutBtn?.addEventListener('click', logout);
    logoutBtnHeader?.addEventListener('click', logout);

    // ====== Navigation (sidebar + top tabs) ======
    function activateSection(section) {
      // tabs
      document.querySelectorAll('.top-nav .tab').forEach(t => t.classList.toggle('active', t.dataset.section === section));
      // sidebar
      document.querySelectorAll('.menu-item').forEach(m => m.classList.toggle('active', m.dataset.section === section));
      // sections
      Object.entries(contentSections).forEach(([key, el]) => { if (!el) return; el.classList.toggle('hidden', key !== section); });
      // close sidebar on mobile
      sidebar.classList.remove('active');
    }
    document.querySelectorAll('.menu-item').forEach(i => i.addEventListener('click', e => { const sec = i.dataset.section; if (sec) { activateSection(sec); if (sec === 'addItem') resetForm(); } }));
    document.querySelectorAll('.top-nav .tab').forEach(t => t.addEventListener('click', () => { const sec = t.dataset.section; activateSection(sec); if (sec === 'addItem') resetForm(); }));

    // mobile hamburger
    menuToggle.addEventListener('click', () => sidebar.classList.toggle('active'));

    // ====== Dashboard ======
    async function loadDashboardData() {
      const { data, error } = await supabase.from('gallery').select('*').order('created_at', { ascending: false }).limit(5);
      if (error) { notify('Error loading dashboard: ' + error.message, true); return; }
      // count
      const { count } = await supabase.from('gallery').select('*', { count: 'exact', head: true });
      totalItemsEl.textContent = count || 0;
      recentItemsEl.innerHTML = '';
      if (!data || data.length === 0) { recentItemsEl.innerHTML = '<tr><td colspan="4" style="text-align:center">No items found.</td></tr>'; return; }
      data.forEach(item => {
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${item.title || '(untitled)'}</td><td>${new Date(item.created_at).toLocaleDateString()}</td><td><span class="status status-published">Published</span></td><td class="actions"><button class="action-btn action-edit" data-id="${item.id}"><i class="fas fa-edit"></i></button><button class="action-btn action-delete" data-id="${item.id}"><i class="fas fa-trash"></i></button></td>`;
        tr.querySelector('.action-edit').addEventListener('click', (e) => { e.stopPropagation(); editItem(item.id); });
        tr.querySelector('.action-delete').addEventListener('click', (e) => { e.stopPropagation(); deleteItem(item.id); });
        recentItemsEl.appendChild(tr);
      });
    }

    // ====== Gallery ======
    async function loadGalleryItems() {
      const { data, error } = await supabase.from('gallery').select('*').order('created_at', { ascending: false });
      if (error) { notify('Error loading gallery: ' + error.message, true); return; }
      galleryItemsEl.innerHTML = '';
      if (!data || data.length === 0) { galleryItemsEl.innerHTML = '<tr><td colspan="6" style="text-align:center">No items found.</td></tr>'; return; }
      data.forEach(item => {
        const tr = document.createElement('tr');
        tr.innerHTML = `<td><img src="${item.image_url}" alt="${item.title || ''}" style="width:50px;height:50px;object-fit:cover;border-radius:8px"></td><td>${item.title || '(untitled)'}</td><td>${item.description ? (item.description.substring(0, 50) + (item.description.length > 50 ? '…' : '')) : ''}</td><td>${new Date(item.created_at).toLocaleDateString()}</td><td><span class="status status-published">Published</span></td><td class="actions"><button class="action-btn action-edit" data-id="${item.id}"><i class="fas fa-edit"></i></button><button class="action-btn action-delete" data-id="${item.id}"><i class="fas fa-trash"></i></button></td>`;
        // open modal on row or image click
        tr.querySelector('td:first-child img').addEventListener('click', () => openModal(item));
        tr.addEventListener('dblclick', () => openModal(item));
        tr.querySelector('.action-edit').addEventListener('click', (e) => { e.stopPropagation(); editItem(item.id); });
        tr.querySelector('.action-delete').addEventListener('click', (e) => { e.stopPropagation(); deleteItem(item.id); });
        galleryItemsEl.appendChild(tr);
      });
    }

    // ====== Modal functions ======
    function openModal(item) {
      modalItem = item;
      modalTitle.textContent = item.title || '(untitled)';
      modalImage.src = item.image_url;
      modalDescription.textContent = item.description || '';
      modalDate.textContent = new Date(item.created_at).toLocaleString();
      galleryModal.style.display = 'flex';
    }
    function closeGalleryModal() { galleryModal.style.display = 'none'; modalItem = null; }
    closeModal.addEventListener('click', closeGalleryModal);
    modalCloseBottom.addEventListener('click', closeGalleryModal);
    galleryModal.addEventListener('click', (e) => { if (e.target === galleryModal) closeGalleryModal(); });
    modalOpen.addEventListener('click', () => { if (modalItem) window.open(modalItem.image_url, '_blank'); });
    modalEdit.addEventListener('click', () => { if (!modalItem) return; closeGalleryModal(); editItem(modalItem.id); });
    modalDelete.addEventListener('click', () => { if (!modalItem) return; const id = modalItem.id; closeGalleryModal(); deleteItem(id); });

    // ====== Edit / Delete ======
    async function editItem(id) {
      const { data, error } = await supabase.from('gallery').select('*').eq('id', id).single();
      if (error) { notify('Error fetching item: ' + error.message, true); return; }
      activateSection('addItem');
      itemTitle.value = data.title || '';
      itemDescription.value = data.description || '';
      currentImageUrl = data.image_url; currentEditingId = id;
      // Show current image in preview grid
      previewGrid.innerHTML = '';
      const div = document.createElement('div'); div.className = 'preview-item'; div.innerHTML = `<img src="${data.image_url}" alt="Preview"/>`;
      previewGrid.appendChild(div);
      notify('Editing item' + (data.title ? ': ' + data.title : ''));
    }

    async function deleteItem(id) {
      if (!confirm('Are you sure you want to delete this item? This action cannot be undone.')) return;
      try {
        // fetch item for storage path
        const { data: itemData, error: fetchError } = await supabase.from('gallery').select('*').eq('id', id).single();
        if (fetchError) throw new Error(fetchError.message);
        // storage remove
        try {
          const url = new URL(itemData.image_url); const pathParts = url.pathname.split('/'); const filePath = pathParts.slice(3).join('/');
          const { error: storageError } = await supabase.storage.from('gallery-images').remove([filePath]);
          if (storageError) console.warn('Storage delete issue:', storageError.message);
        } catch (_) {/* ignore url parse issues */ }
        // db delete
        const { error: deleteError } = await supabase.from('gallery').delete().eq('id', id);
        if (deleteError) throw new Error(deleteError.message);
        notify('Item deleted successfully');
        // Refresh + go to nice deleted page
        await loadDashboardData(); await loadGalleryItems();
        activateSection('deleted');
      } catch (err) { notify('Error deleting item: ' + err.message, true); }
    }

    function resetForm() {
      addItemForm.reset(); selectedFiles = []; currentEditingId = null; currentImageUrl = null; previewGrid.innerHTML = ''; formMessage.textContent = '';
    }

    // ====== Drag & drop + previews ======
    function renderPreviews() {
      previewGrid.innerHTML = '';
      selectedFiles.forEach((file, idx) => {
        const url = URL.createObjectURL(file);
        const div = document.createElement('div'); div.className = 'preview-item';
        div.innerHTML = `<img src="${url}" alt="preview ${idx}"><button class="remove" title="Remove" data-idx="${idx}"><i class="fas fa-xmark"></i></button>`;
        div.querySelector('.remove').addEventListener('click', (e) => { const i = Number(e.currentTarget.dataset.idx); selectedFiles.splice(i, 1); renderPreviews(); });
        previewGrid.appendChild(div);
      });
    }

    dropzone.addEventListener('click', () => itemImage.click());
    dropzone.addEventListener('dragover', (e) => { e.preventDefault(); dropzone.classList.add('dragover'); });
    dropzone.addEventListener('dragleave', () => dropzone.classList.remove('dragover'));
    dropzone.addEventListener('drop', (e) => { e.preventDefault(); dropzone.classList.remove('dragover'); const files = [...e.dataTransfer.files].filter(f => f.type.startsWith('image/')); if (files.length) { selectedFiles.push(...files); renderPreviews(); } });
    itemImage.addEventListener('change', (e) => { const files = [...e.target.files]; if (files.length) { selectedFiles.push(...files); renderPreviews(); itemImage.value = ''; } });

    // ====== Add / Update items (multi-upload; title optional) ======
    addItemForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      formMessage.style.color = '#1976d2';
      const title = itemTitle.value.trim();
      const description = itemDescription.value.trim();

      // Update single item case
      if (currentEditingId) {
        try {
          // If new images selected, just take the first one to replace
          if (selectedFiles.length) {
            const imageFile = selectedFiles[0];
            const fileExt = imageFile.name.split('.').pop();
            const fileName = `${Math.random().toString(36).slice(2)}.${fileExt}`;
            const filePath = `gallery/${fileName}`;
            progressBarContainer.style.display = 'block'; progressBar.style.width = '0%';
            const { error: uploadError } = await supabase.storage.from('gallery-images').upload(filePath, imageFile, {
              cacheControl: '3600', upsert: false
            });
            if (uploadError) throw new Error(uploadError.message);
            const { data: urlData } = supabase.storage.from('gallery-images').getPublicUrl(filePath);
            currentImageUrl = urlData.publicUrl;
          }
          const updateData = { title: title || null, description: description || null };
          if (selectedFiles.length) updateData.image_url = currentImageUrl;
          const { error: updateError } = await supabase.from('gallery').update(updateData).eq('id', currentEditingId);
          if (updateError) throw new Error(updateError.message);
          notify('Item updated successfully!'); formMessage.textContent = 'Item updated successfully!'; formMessage.style.color = '#0c7c59';
          resetForm(); progressBarContainer.style.display = 'none'; loadDashboardData(); loadGalleryItems(); activateSection('gallery');
        } catch (err) { notify('Error: ' + err.message, true); formMessage.textContent = 'Error: ' + err.message; progressBarContainer.style.display = 'none'; }
        return;
      }

      // Create (multi) items
      if (!selectedFiles.length) { formMessage.textContent = 'Please select at least one image.'; formMessage.style.color = '#d32f2f'; return; }
      progressBarContainer.style.display = 'block'; progressBar.style.width = '0%';
      try {
        const uploads = [];
        let uploaded = 0;
        for (const imageFile of selectedFiles) {
          const fileExt = imageFile.name.split('.').pop();
          const fileName = `${Date.now()}-${Math.random().toString(36).slice(2)}.${fileExt}`;
          const filePath = `gallery/${fileName}`;
          const { error: uploadError } = await supabase.storage.from('gallery-images').upload(filePath, imageFile, { cacheControl: '3600', upsert: false });
          if (uploadError) throw new Error(uploadError.message);
          const { data: urlData } = supabase.storage.from('gallery-images').getPublicUrl(filePath);
          uploads.push({ image_url: urlData.publicUrl, title: title || imageFile.name.replace(/\.[^.]+$/, ''), description: description || null });
          uploaded++; progressBar.style.width = `${Math.round((uploaded / selectedFiles.length) * 100)}%`;
        }
        // bulk insert
        const { error: insertError } = await supabase.from('gallery').insert(uploads);
        if (insertError) throw new Error(insertError.message);
        notify('Items added successfully!'); formMessage.textContent = 'Items added successfully!'; formMessage.style.color = '#0c7c59';
        resetForm(); progressBarContainer.style.display = 'none'; loadDashboardData(); loadGalleryItems(); activateSection('gallery');
      } catch (err) { notify('Error: ' + err.message, true); formMessage.textContent = 'Error: ' + err.message; formMessage.style.color = '#d32f2f'; progressBarContainer.style.display = 'none'; }
    });

    // ====== Refresh gallery ======
    refreshGalleryBtn.addEventListener('click', () => { loadGalleryItems(); notify('Gallery refreshed'); });

    // Deleted page actions
    backToGallery.addEventListener('click', () => activateSection('gallery'));
    addMore.addEventListener('click', () => activateSection('addItem'));

    // ====== Service Worker (kept minimal) ======
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/sw.js').catch(() => { });
      });
    }

    // ====== Startup ======
    checkAuth();
  </script>
</body>

</html>